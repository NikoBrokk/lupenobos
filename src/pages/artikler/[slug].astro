---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection, getEntryBySlug } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("articles", (p) => !p.data?.draft);
  return posts.map((post) => ({
    // Viktig: slug som STRING, ikke array
    params: { slug: post.slug },
  }));
}

const { slug } = Astro.params;
const entry = await getEntryBySlug("articles", slug);
if (!entry) throw new Error(`Fant ikke artikkel: ${slug}`);

const { Content, data } = await entry.render();
const dateText = data.date
  ? new Date(data.date).toLocaleDateString("no-NO")
  : "";
---

<BaseLayout title={`${data.title} – Lupen OBOS`} description={data.excerpt}>
  <article class="prose lg:prose-lg max-w-none">
    {data.cover && <img src={data.cover} alt={data.title ?? ""} class="rounded-2xl w-full" />}
    <h1>{data.title}</h1>
    {(dateText || data.author) && (
      <p class="text-gray-500 text-sm">
        {dateText}{dateText && data.author ? " · " : ""}{data.author}
      </p>
    )}
    <Content />
  </article>
</BaseLayout>
